<li class="tree-item <% if competency.children.present? %>has-children collapsed<% end %>">
  <div class="header">
    <% if competency.children.present? %>
      <div class="collapse-toggle"><span>❯</span></div>
    <% end %>
    <div class="details-toggle p-1">
      <% if competency.code.present? %>
        <strong><%= competency.code %></strong>
      <% end %>
      <%= competency.abbreviated_competency_text || competency.competency_text %>
    </div>
  </div>

  <div class="details">
    <h6>Competency details</h6>
    <div class="table-wrapper">
      <table class="table">
        <tbody>
          <% COMPETENCY_ATTRIBUTES.each do |attribute| %>
            <% if competency[attribute[:key]].present? %>
              <% val = Array(competency[attribute[:key]]) %>

              <tr>
                <th><%= attribute[:label] %></th>
                <td>
                  <% if val.size > 1 %>
                    <% if val.any? { |v| v.length > 20 } %>
                      <ul>
                        <% val.each do |v| %>
                          <li><%= simple_format(v) %></li>
                        <% end %>
                      </ul>
                    <% else %>
                      <%= val.join(", ") %>
                    <% end %>
                  <% else %>
                    <%= simple_format(val.first) %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <% if competency.children.present? %>
    <ul class="children list-unstyled">
      <%= render partial: "competency_frameworks/show/tree_item", collection: competency.children, as: :competency %>
    </ul>
  <% end %>
</li>
